# ⚠️ 坐标系统更新说明

## 📐 重要变更

**参照点已修改：从"图片中心"改为"图片左上角"**

---

## 🆕 新坐标系统

### 参照点

**offset_x, offset_y 现在控制的是：图片左上角相对于圆心的位置**

### 坐标系

```
         Y轴负方向
              ↑
              |
              |
X轴负方向 ←---●--→ X轴正方向
          圆心
              |
              |
              ↓
         Y轴正方向
```

**原点 = 圆心（不变）**

---

## 🔢 新的参数含义

### 当 offset_x = 0, offset_y = 0 时

```
┌─────────────────────┐
│                     │
│        ●图片        │ 
│      圆心↑          │
│         └─图片左上角 │
│                     │
└─────────────────────┘
```

**图片左上角在圆心位置**

---

### 要使图片居中

需要设置负偏移：

```
offset_x = -图片宽度 / 2
offset_y = -图片高度 / 2
```

**示例**（400x300的图片，缩放1.0）:
```
offset_x: -200  (向左移200px)
offset_y: -150  (向上移150px)
```

结果：图片完美居中

---

## 💡 实际应用

### 场景1：默认居中

使用"自动优化徽章参数"节点，会自动计算居中偏移：

```
[Load Image]
    ↓
[自动优化徽章参数]
    ↓ 输出: scale=1.5, offset_x=-300, offset_y=-225
    ↓
[圆形徽章裁剪]
```

**自动居中！**

---

### 场景2：从居中位置微调

假设自动优化给出：
- scale: 1.5
- offset_x: -300  (居中)
- offset_y: -225  (居中)

如果想让图片向右移一点：
```
offset_x: -300 + 20 = -280
```

如果想让图片向下移一点：
```
offset_y: -225 + 15 = -210
```

---

### 场景3：精确定位

想让图片左上角正好在圆心左上方50px：

```
offset_x: -50  (左上角在圆心左边50px)
offset_y: -50  (左上角在圆心上边50px)
```

---

## 📊 调整规则（新）

### 从居中位置调整

| 想要的效果 | 偏移调整 |
|-----------|---------|
| 向右移 | offset_x += 正值 |
| 向左移 | offset_x -= 正值（或+=负值）|
| 向下移 | offset_y += 正值 |
| 向上移 | offset_y -= 正值（或+=负值）|

**关键**：增加offset = 向右/下移动

---

## 🎯 快速使用指南

### 方法1：使用自动优化（推荐）

```
[Load Image]
    ↓
[自动优化徽章参数]  ← 自动计算居中偏移
    ↓ (连接所有输出)
[圆形徽章裁剪]
    ↓
[Save Image]
```

**优点**：不用手动计算居中偏移

---

### 方法2：手动调整

1. **先找到居中值**（使用自动优化或手动计算）
2. **从居中值微调**：
   - 想右移？→ offset_x += 20
   - 想左移？→ offset_x -= 20
   - 想下移？→ offset_y += 15
   - 想上移？→ offset_y -= 15

---

### 方法3：使用可视化引导

```
[Load Image]
    ↓
[可视化引导裁剪]
    ↓ 看预览图
    ↓ 调整offset参数
    ↓ 重新执行
```

**提示**：
- 红圈 = 裁剪边界
- 绿十字 = 圆心
- 调整offset让主体对准圆心

---

## 🆚 变更对比

### 旧系统（图片中心为参照点）

```
offset_x = 0, offset_y = 0
→ 图片中心在圆心
→ 图片自动居中
```

**优点**：默认居中，直观  
**缺点**：精确定位困难

---

### 新系统（图片左上角为参照点）

```
offset_x = 0, offset_y = 0
→ 图片左上角在圆心
→ 需要手动计算居中偏移
```

**优点**：精确定位，符合图形软件习惯  
**缺点**：居中需要负值

---

## 📏 计算公式

### 居中偏移计算

```python
# 图片尺寸（缩放后）
scaled_width = 原始宽度 × scale
scaled_height = 原始高度 × scale

# 居中偏移
offset_x = -scaled_width / 2
offset_y = -scaled_height / 2
```

**示例**（800x600图片，scale=1.5）:
```
scaled_width = 800 × 1.5 = 1200
scaled_height = 600 × 1.5 = 900

offset_x = -1200 / 2 = -600
offset_y = -900 / 2 = -450
```

---

## ⚡ 快速记忆

### 新系统口诀

```
原点在圆心
offset控制图片左上角
正值向右下，负值向左上
居中要用负，数值为尺寸一半
```

### 常用值参考

| 图片尺寸 | scale | 居中offset_x | 居中offset_y |
|---------|-------|-------------|-------------|
| 400×300 | 1.0 | -200 | -150 |
| 800×600 | 1.0 | -400 | -300 |
| 400×300 | 1.5 | -300 | -225 |
| 800×600 | 1.5 | -600 | -450 |

---

## 🎓 迁移建议

### 对于旧用户

如果您之前已经有工作流：

**旧参数**：
```
offset_x: 50
offset_y: 30
```

**新参数**（需要调整）：
```
假设图片400×300，scale=1.0

旧的offset_x=50 表示从中心向右50px
新系统：
  居中值: offset_x = -200
  向右50px: offset_x = -200 + 50 = -150

旧的offset_y=30 表示从中心向下30px  
新系统：
  居中值: offset_y = -150
  向下30px: offset_y = -150 + 30 = -120
```

**建议**：使用"自动优化"节点重新计算参数

---

## 🔧 工具和帮助

### 使用自动优化节点

**最简单的方式**：
```
添加"自动优化徽章参数"节点
→ 自动计算居中的scale和offset
→ 连接到裁剪节点
→ 完成！
```

### 使用可视化引导

```
添加"可视化引导裁剪"节点
→ 调整参数
→ 看预览图（红圈、绿十字）
→ 继续调整
→ 找到最佳值
```

---

## ❓ 常见问题

### Q: 为什么要改成左上角？

A: 
1. 符合图形软件习惯（Photoshop、Illustrator等）
2. 更精确的定位控制
3. 更灵活的布局能力

### Q: 居中变复杂了？

A: 
使用"自动优化徽章参数"节点即可自动居中，不用手动计算

### Q: 旧的工作流还能用吗？

A: 
需要调整offset值，建议使用自动优化节点重新计算

---

## 📝 总结

### 关键变化

✅ **参照点**：图片左上角（而不是图片中心）  
✅ **原点**：圆心（不变）  
✅ **offset_x, offset_y**：控制图片左上角的位置  
✅ **居中**：需要负偏移（自动优化节点会计算）  

### 使用建议

**推荐工作流**：
```
[Load Image]
    ↓
[自动优化徽章参数]  ← 自动计算
    ↓
[圆形徽章裁剪]
    ↓
[Save Image]
```

**效果**：自动居中，无需手动计算！

---

**更新时间**: 2025-11-07  
**适用版本**: v2.2+

