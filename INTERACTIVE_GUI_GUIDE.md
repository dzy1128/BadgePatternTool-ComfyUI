# 🎮 交互式GUI编辑器 - 使用指南

## ✨ 新功能：真正的鼠标拖拽界面！

现在您可以像使用桌面软件一样，**直接用鼠标拖动图片、滚轮缩放**了！

---

## 🆕 交互式拖拽编辑器节点

### 功能特点

✅ **鼠标拖拽** - 按住鼠标左键拖动图片位置  
✅ **滚轮缩放** - 滚动鼠标滚轮放大/缩小图片  
✅ **实时预览** - 显示红色裁剪边界和绿色参考线  
✅ **参数同步** - 拖拽和缩放自动更新参数值  
✅ **所见即所得** - 在编辑器中看到的效果就是最终效果  

---

## 📦 安装步骤

### 1. 确认文件结构

安装后，您的文件夹应该是这样的：

```
ComfyUI/custom_nodes/BadgePatternTool-ComfyUI/
├── __init__.py
├── nodes.py
└── web/
    └── badge_interactive.js  ← 前端交互文件
```

### 2. 重启ComfyUI

完全关闭ComfyUI并重新启动（不是刷新网页）

### 3. 验证安装

在浏览器控制台（F12）中应该看到：
```
BadgePatternTool 交互式编辑器已加载
```

---

## 🚀 使用方法

### 基础工作流

```
[Load Image] 
    ↓
[🎮 交互式拖拽编辑器]  ← 在这里用鼠标拖拽和缩放！
    ↓
[Save Image]
```

### 操作步骤

1. **添加节点**
   - 右键 → "徽章工具/交互编辑" 
   - 选择"🎮 交互式拖拽编辑器"

2. **连接图片**
   - 将Load Image的输出连接到编辑器的image输入

3. **鼠标操作**
   - **拖动**: 在编辑器区域按住鼠标左键拖动
   - **缩放**: 在编辑器区域滚动鼠标滚轮

4. **查看效果**
   - 编辑器中显示：
     - 🔴 红色圆圈 = 最终裁剪边界
     - 🟢 绿色十字 = 中心参考点
     - 实时显示当前缩放和偏移值

5. **执行裁剪**
   - 调整满意后，点击执行工作流
   - 输出"裁剪结果"即为最终图片

---

## 🎨 界面说明

### 编辑器画布

```
┌─────────────────────────────────┐
│   [交互式编辑器 - 300px高]      │
│                                  │
│         ┌───🟢───┐              │
│         │   图片  │              │
│      🟢─┼── 🔴 ──┼─🟢           │
│         │        │              │
│         └───🟢───┘              │
│                                  │
│   🖱️ 拖拽移动 | 🔍 滚轮缩放    │
│                                  │
│   缩放: 1.20x | 偏移: (45, -20) │
└─────────────────────────────────┘
```

### 视觉元素

- **背景**: 深灰色画布
- **🔴 红色圆圈**: 裁剪边界（图片在圆外的部分会被裁掉）
- **🟢 绿色十字**: 中心参考线
- **底部文字**: 实时显示当前参数

---

## 💡 操作技巧

### 技巧1：精确定位

1. 先用鼠标拖到大致位置
2. 再用滚轮微调大小
3. 最后再微调位置

### 技巧2：居中对齐

- 绿色十字交点 = 圆形中心
- 将主体内容对准十字中心

### 技巧3：控制裁剪范围

- 确保重要内容在红色圆圈内
- 红圈外的部分会被裁掉

### 技巧4：参数记录

- 编辑器底部显示当前参数
- 可以截图保存，用于批量处理

---

## 🔧 参数说明

### 输入参数

| 参数 | 说明 | 调整方式 |
|-----|------|---------|
| `image` | 输入图片 | 连接Load Image |
| `diameter_mm` | 徽章直径 | 手动输入 |
| `dpi` | 分辨率 | 手动输入 |
| `scale` | 缩放比例 | 滚轮或手动 |
| `offset_x` | X轴偏移 | 拖拽或手动 |
| `offset_y` | Y轴偏移 | 拖拽或手动 |

### 输出内容

1. **裁剪结果** - 最终的圆形徽章图片
2. **当前缩放** - 当前缩放值（可连接其他节点）
3. **当前偏移X** - 当前X偏移值
4. **当前偏移Y** - 当前Y偏移值
5. **使用说明** - 文字说明（用于查看）

---

## 📝 完整工作流示例

### 示例1：单张图片交互式编辑

```
[Load Image] 
    ↓
[🎮 交互式拖拽编辑器]
    ↓ (鼠标拖拽和缩放)
[Preview Image] (查看"裁剪结果")
    ↓
[Save Image]
```

### 示例2：批量处理（找好参数）

```
[Load Image] (第一张代表图)
    ↓
[🎮 交互式拖拽编辑器]
    ↓ (拖拽找到最佳参数)
    ├─→ "当前缩放" ─┐
    ├─→ "当前偏移X" ─┤
    ├─→ "当前偏移Y" ─┤
    ↓                  ↓
[Load Image] (其他图片)
    ↓                  ↓
[圆形徽章裁剪] ←──(连接参数)
    ↓
[徽章A4排版]
    ↓
[Save Image]
```

### 示例3：实时调整+排版

```
[Load Image (批次)]
    ↓
[🎮 交互式拖拽编辑器] (调整第一张)
    ↓
[徽章A4排版]
    ↓
[Save Image]
```

---

## ⚙️ 高级设置

### 自定义画布大小

如需修改编辑器画布大小，编辑 `web/badge_interactive.js`:

```javascript
// 找到这一行
return [width, 300];  // 300是高度

// 修改为
return [width, 500];  // 改成500px高
```

### 调整缩放灵敏度

```javascript
// 找到这一行
const delta = event.deltaY > 0 ? 0.95 : 1.05;

// 调整为
const delta = event.deltaY > 0 ? 0.98 : 1.02;  // 更平滑
```

---

## 🐛 故障排除

### 问题1：看不到交互式编辑器节点

**检查**:
1. 确认 `web/badge_interactive.js` 文件存在
2. 完全重启ComfyUI（不是刷新）
3. 查看浏览器控制台（F12）是否有错误

**解决**:
```bash
# 检查文件
ls ComfyUI/custom_nodes/BadgePatternTool-ComfyUI/web/

# 应该看到 badge_interactive.js
```

---

### 问题2：拖拽不生效

**可能原因**:
- 前端JS未加载
- 浏览器缓存

**解决**:
1. 清空浏览器缓存（Ctrl+Shift+Delete）
2. 强制刷新（Ctrl+F5）
3. 完全重启ComfyUI

---

### 问题3：参数不同步

**现象**: 拖拽后参数值没变化

**解决**:
- 确保使用的是"🎮 交互式拖拽编辑器"节点
- 不是普通的"圆形徽章裁剪"节点

---

### 问题4：画布显示空白

**可能原因**:
- 图片还未加载
- 前端渲染错误

**解决**:
1. 确保已连接Load Image
2. 先执行一次工作流
3. 查看浏览器控制台错误信息

---

## 🆚 对比：不同编辑方式

| 方式 | 优点 | 缺点 | 适用场景 |
|-----|------|------|---------|
| 🎮 **交互式拖拽** | 直观、快速、所见即所得 | 需要前端支持 | 单张精细调整 |
| 👁️ 可视化引导 | 有参考线，输出预览图 | 需要手动输入参数 | 需要保存预览图 |
| 🎮 参数微调 | 精确控制，批量友好 | 不够直观 | 批量处理 |
| 🔢 手动输入 | 最灵活 | 最不直观 | 知道精确值时 |

---

## 💡 使用建议

### 新手推荐流程

1. **第一次使用**
   - 用🎮 交互式拖拽编辑器
   - 体验鼠标操作的便利性

2. **找到感觉后**
   - 记录常用参数
   - 可以切换到其他节点批量处理

3. **专业用户**
   - 交互式编辑器 + 批量裁剪节点组合
   - 效率最高

---

## 🎓 学习路径

### Day 1：熟悉操作
```
目标: 能用鼠标拖拽和缩放
练习: 导入一张图片，随意拖动和缩放
```

### Day 2：精确控制
```
目标: 能精确定位主体到圆心
练习: 将人脸/Logo居中对准绿色十字
```

### Day 3：实战应用
```
目标: 完整工作流
练习: 从导入到最终保存，完成完整流程
```

---

## 📊 性能说明

- **响应速度**: 实时（拖拽无延迟）
- **渲染性能**: 轻量级（不影响ComfyUI运行）
- **浏览器要求**: 支持Canvas API的现代浏览器

---

## 🔮 未来改进计划

- [ ] 支持加载实际图片预览（目前显示占位符）
- [ ] 添加撤销/重做功能
- [ ] 支持键盘快捷键（方向键移动）
- [ ] 添加网格吸附功能
- [ ] 支持保存预设参数

---

## 🙏 反馈和建议

如果您有任何问题或建议，欢迎：

1. 查看本文档的故障排除部分
2. 在GitHub提交Issue
3. 提供使用体验反馈

---

## 🎉 总结

### 您现在可以：

✅ **用鼠标直接拖动图片** - 按住左键拖拽  
✅ **用滚轮缩放图片** - 滚动放大缩小  
✅ **实时看到裁剪边界** - 红色圆圈  
✅ **所见即所得** - 编辑即最终效果  

### 不再需要：

❌ 猜测参数值  
❌ 反复试错  
❌ 手动计算偏移量  

---

**享受直观的拖拽编辑体验吧！** 🎮✨

